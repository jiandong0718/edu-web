# 学员批量导入功能

## 功能概述

学员批量导入功能允许管理员通过上传 Excel 文件批量导入学员信息，提高数据录入效率。

## 功能特性

### 1. Excel 文件上传
- 支持 `.xlsx` 和 `.xls` 格式
- 文件大小限制：10MB
- 拖拽上传或点击选择文件
- 单次最多导入 1000 条数据

### 2. 导入模板下载
- 提供标准化的 Excel 导入模板
- 包含所有必填字段和示例数据
- 字段说明和格式要求

### 3. 三步导入流程
1. **上传文件**：选择要导入的 Excel 文件
2. **确认导入**：检查文件信息并开始导入
3. **导入完成**：查看导入结果和错误详情

### 4. 导入进度显示
- 实时显示导入进度
- 加载动画提示
- 导入状态反馈

### 5. 导入结果反馈
- 成功导入数量统计
- 失败导入数量统计
- 成功率百分比进度条
- 详细的错误信息列表

### 6. 错误信息展示
- 错误行号定位
- 具体错误原因说明
- 支持分页查看错误列表
- 便于快速定位和修正问题

## 使用方式

### 方式一：独立导入页面

访问学员批量导入页面（`/student/import`），按照页面提示完成导入操作。

```tsx
// 路由配置
{
  path: '/student/import',
  element: <StudentImport />,
}
```

### 方式二：学员列表页面集成

在学员列表页面点击"批量导入"按钮，在弹窗中完成导入操作。

```tsx
import { StudentBatchImport } from '@/components/StudentBatchImport';

function StudentList() {
  const [isImportModalOpen, setIsImportModalOpen] = useState(false);

  const handleImportSuccess = () => {
    // 导入成功后刷新列表
    refreshList();
  };

  return (
    <>
      <Button onClick={() => setIsImportModalOpen(true)}>
        批量导入
      </Button>

      <StudentBatchImport
        open={isImportModalOpen}
        onCancel={() => setIsImportModalOpen(false)}
        onSuccess={handleImportSuccess}
      />
    </>
  );
}
```

## Excel 模板格式

### 必填字段

| 字段名 | 说明 | 格式要求 | 示例 |
|--------|------|----------|------|
| 姓名 | 学员姓名 | 文本，不超过50字符 | 张小明 |
| 性别 | 学员性别 | 男 或 女 | 男 |
| 手机号 | 学员手机号 | 11位数字 | 13800138001 |
| 家长姓名 | 家长姓名 | 文本，不超过50字符 | 张伟 |
| 家长电话 | 家长联系电话 | 11位数字 | 13800138000 |
| 出生日期 | 学员出生日期 | YYYY-MM-DD | 2010-01-15 |
| 地址 | 家庭住址 | 文本，不超过200字符 | 北京市朝阳区xxx街道 |
| 学校 | 就读学校 | 文本，不超过100字符 | 北京市第一小学 |
| 年级 | 就读年级 | 文本 | 三年级 |
| 所属校区 | 校区ID | 数字 | 1 |
| 入学日期 | 入学日期 | YYYY-MM-DD | 2024-03-15 |

### 可选字段

| 字段名 | 说明 | 格式要求 | 示例 |
|--------|------|----------|------|
| 身份证号 | 学员身份证号 | 18位数字或字母 | 110101201001011234 |
| 备注 | 其他备注信息 | 文本，不超过500字符 | 对数学特别感兴趣 |

## 数据验证规则

### 1. 必填字段验证
- 所有必填字段不能为空
- 空值将导致该行导入失败

### 2. 格式验证
- **手机号**：必须是11位数字
- **日期**：必须符合 YYYY-MM-DD 格式
- **性别**：只能是"男"或"女"
- **校区ID**：必须是有效的校区ID

### 3. 数据长度验证
- 姓名：不超过50字符
- 地址：不超过200字符
- 学校：不超过100字符
- 备注：不超过500字符

### 4. 业务规则验证
- 手机号不能重复（与系统已有数据对比）
- 校区ID必须存在于系统中
- 出生日期不能晚于入学日期

## 错误处理

### 常见错误及解决方案

| 错误信息 | 原因 | 解决方案 |
|----------|------|----------|
| 姓名不能为空 | 姓名字段为空 | 填写学员姓名 |
| 手机号格式不正确 | 手机号不是11位数字 | 检查手机号格式 |
| 手机号已存在 | 该手机号已被使用 | 更换手机号或检查是否重复导入 |
| 日期格式不正确 | 日期格式不符合要求 | 使用 YYYY-MM-DD 格式 |
| 性别只能是男或女 | 性别字段值不正确 | 填写"男"或"女" |
| 校区不存在 | 校区ID无效 | 检查校区ID是否正确 |

### 错误信息展示

导入完成后，如果有失败记录，系统会展示详细的错误列表：

- **行号**：标识出错的数据行（从第2行开始，第1行为表头）
- **错误信息**：具体的错误原因
- **分页显示**：支持分页查看，每页显示5条错误记录

## API 接口

### 1. 下载导入模板

```typescript
GET /student/import-template

Response: Excel 文件流
```

### 2. 批量导入学员

```typescript
POST /student/batch-import
Content-Type: multipart/form-data

Request:
- file: Excel 文件

Response:
{
  success: number;      // 成功导入数量
  failed: number;       // 失败导入数量
  errors: Array<{       // 错误详情列表
    row: number;        // 错误行号
    message: string;    // 错误信息
  }>;
}
```

## 技术实现

### 组件结构

```
src/
├── components/
│   └── StudentBatchImport/
│       └── index.tsx           # 批量导入弹窗组件
├── pages/
│   └── student/
│       ├── import/
│       │   └── index.tsx       # 独立导入页面
│       └── list/
│           └── index.tsx       # 学员列表页面（集成导入功能）
├── api/
│   └── student.ts              # 学员相关 API
└── types/
    └── student.ts              # 学员类型定义
```

### 核心技术

- **React 18+**：组件开发
- **TypeScript**：类型安全
- **Ant Design 5.x**：UI 组件库
  - `Upload.Dragger`：拖拽上传
  - `Steps`：步骤条
  - `Progress`：进度条
  - `Table`：错误列表展示
  - `Result`：结果反馈
- **Axios**：HTTP 请求
- **FormData**：文件上传

### 样式特点

- 深色科技风格主题
- 青色渐变主色调（#00d4ff → #0099ff）
- 玻璃态效果
- 发光边框
- 流畅的动画过渡

## 最佳实践

### 1. 数据准备
- 先下载模板，了解字段要求
- 按照模板格式整理数据
- 确保数据完整性和准确性

### 2. 分批导入
- 建议每次导入不超过500条数据
- 大批量数据分多次导入
- 降低单次导入失败风险

### 3. 错误处理
- 仔细查看错误信息
- 修正错误数据后重新导入
- 保留原始数据备份

### 4. 数据验证
- 导入前在 Excel 中进行初步验证
- 检查必填字段是否完整
- 确认数据格式是否正确

## 注意事项

1. **文件格式**：只支持 Excel 格式（.xlsx, .xls），不支持 CSV
2. **文件大小**：单个文件不超过 10MB
3. **数据量限制**：单次最多导入 1000 条数据
4. **校区权限**：只能导入当前用户有权限的校区的学员
5. **数据去重**：系统会根据手机号进行去重验证
6. **导入时间**：大批量数据导入可能需要较长时间，请耐心等待

## 未来优化方向

1. **数据预览**：导入前预览 Excel 数据
2. **增量导入**：支持更新已有学员信息
3. **导入历史**：记录导入历史和操作日志
4. **模板定制**：支持自定义导入模板字段
5. **异步导入**：大批量数据异步处理，支持后台导入
6. **导入进度**：实时显示导入进度百分比
7. **错误导出**：支持导出错误数据为 Excel 文件
