# 排课管理模块组件结构图

```
┌─────────────────────────────────────────────────────────────────┐
│                    排课管理主页面 (index.tsx)                      │
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐ │
│  │                    Tabs 标签页切换                          │ │
│  └───────────────────────────────────────────────────────────┘ │
│                                                                 │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐   │
│  │ 课表查看     │  │ 批量排课     │  │ 调课/代课/停课       │   │
│  │ (Tab 1)     │  │ (Tab 2)     │  │ (Tab 3)             │   │
│  └─────────────┘  └─────────────┘  └─────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
         │                  │                      │
         ▼                  ▼                      ▼
┌──────────────────┐ ┌──────────────────┐ ┌──────────────────────┐
│ ScheduleCalendar │ │BatchScheduleForm │ │ ScheduleOperations   │
│                  │ │                  │ │                      │
│ ┌──────────────┐ │ │ ┌──────────────┐ │ │ ┌──────────────────┐ │
│ │ 查看维度选择  │ │ │ │ 基本信息表单  │ │ │ │ 课表列表         │ │
│ │ - 按班级     │ │ │ │ - 班级       │ │ │ │ - 班级/课程      │ │
│ │ - 按教师     │ │ │ │ - 课程       │ │ │ │ - 教师/教室      │ │
│ │ - 按教室     │ │ │ │ - 教师       │ │ │ │ - 时间/状态      │ │
│ └──────────────┘ │ │ │ - 教室       │ │ │ └──────────────────┘ │
│                  │ │ └──────────────┘ │ │                      │
│ ┌──────────────┐ │ │                  │ │ ┌──────────────────┐ │
│ │ 视图模式切换  │ │ │ ┌──────────────┐ │ │ │ 操作按钮         │ │
│ │ - 月视图     │ │ │ │ 时间设置     │ │ │ │ - 调课           │ │
│ │ - 周视图     │ │ │ │ - 开始日期   │ │ │ │ - 代课           │ │
│ └──────────────┘ │ │ │ - 结束日期   │ │ │ │ - 停课           │ │
│                  │ │ │ - 重复规则   │ │ │ └──────────────────┘ │
│ ┌──────────────┐ │ │ │ - 总课次     │ │ │                      │
│ │ 日历视图     │ │ │ └──────────────┘ │ │ ┌──────────────────┐ │
│ │              │ │ │                  │ │ │ 操作弹窗         │ │
│ │  [课程卡片]  │ │ │ ┌──────────────┐ │ │ │ - 调课表单       │ │
│ │  [课程卡片]  │ │ │ │ 时间段管理   │ │ │ │ - 代课表单       │ │
│ │  [课程卡片]  │ │ │ │ - 添加时间段 │ │ │ │ - 停课表单       │ │
│ │              │ │ │ │ - 删除时间段 │ │ │ │ - 冲突检测       │ │
│ └──────────────┘ │ │ └──────────────┘ │ │ └──────────────────┘ │
│                  │ │                  │ │                      │
│ ┌──────────────┐ │ │ ┌──────────────┐ │ └──────────────────────┘
│ │ 课程详情弹窗  │ │ │ │ 其他选项     │ │
│ │ - 班级信息   │ │ │ │ - 跳过节假日 │ │
│ │ - 课程信息   │ │ │ │ - 跳过周末   │ │
│ │ - 教师信息   │ │ │ │ - 备注       │ │
│ │ - 时间信息   │ │ │ └──────────────┘ │
│ └──────────────┘ │ │                  │
└──────────────────┘ │ ┌──────────────┐ │
                     │ │ 排课预览     │ │
                     │ │ - 预览表格   │ │
                     │ │ - 确认排课   │ │
                     │ └──────────────┘ │
                     └──────────────────┘
```

## 数据流向

```
┌─────────────┐
│   用户操作   │
└──────┬──────┘
       │
       ▼
┌─────────────┐      ┌─────────────┐
│  组件状态    │ ───> │  API 调用   │
└──────┬──────┘      └──────┬──────┘
       │                    │
       │                    ▼
       │             ┌─────────────┐
       │             │  后端接口    │
       │             └──────┬──────┘
       │                    │
       │                    ▼
       │             ┌─────────────┐
       │             │  响应数据    │
       │             └──────┬──────┘
       │                    │
       ▼                    ▼
┌─────────────────────────────┐
│      更新 UI 显示            │
└─────────────────────────────┘
```

## API 接口关系

```
┌──────────────────────────────────────────────────────────┐
│                      API 层 (schedule.ts)                 │
├──────────────────────────────────────────────────────────┤
│                                                          │
│  getScheduleList()          ─────> GET /schedule/list   │
│  batchScheduleEnhanced()    ─────> POST /batch-enhanced │
│  checkConflict()            ─────> POST /check-conflict │
│  rescheduleClass()          ─────> PUT /reschedule      │
│  substituteTeacher()        ─────> PUT /substitute      │
│  cancelSchedule()           ─────> PUT /cancel          │
│                                                          │
└──────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────┐
│                   HTTP 客户端 (request.ts)                │
├──────────────────────────────────────────────────────────┤
│                                                          │
│  - 请求拦截器 (添加 Token)                                │
│  - 响应拦截器 (错误处理)                                  │
│  - 统一错误提示                                           │
│                                                          │
└──────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────┐
│                      后端 API 服务                        │
└──────────────────────────────────────────────────────────┘
```

## 类型系统

```
┌──────────────────────────────────────────────────────────┐
│                  类型定义 (schedule.ts)                   │
├──────────────────────────────────────────────────────────┤
│                                                          │
│  Schedule                  ─> 课表实体                    │
│  ScheduleStatus            ─> 状态枚举                    │
│  RepeatType                ─> 重复规则类型                │
│  BatchScheduleRequest      ─> 批量排课请求                │
│  ConflictCheckRequest      ─> 冲突检测请求                │
│  ConflictCheckResponse     ─> 冲突检测响应                │
│  RescheduleRequest         ─> 调课请求                    │
│  SubstituteRequest         ─> 代课请求                    │
│  CancelScheduleRequest     ─> 停课请求                    │
│  TimeSlot                  ─> 时间段                      │
│  SchedulePreviewItem       ─> 预览项                      │
│                                                          │
└──────────────────────────────────────────────────────────┘
         │                    │                    │
         ▼                    ▼                    ▼
┌──────────────┐  ┌──────────────────┐  ┌──────────────────┐
│ API 层使用   │  │ 组件 Props 使用   │  │ 组件 State 使用  │
└──────────────┘  └──────────────────┘  └──────────────────┘
```

## 状态管理

```
┌─────────────────────────────────────────────────────────┐
│              排课管理主页面 (index.tsx)                    │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  State:                                                 │
│  - activeTab: string          (当前激活的标签)           │
│  - refreshKey: number         (刷新键，用于触发子组件刷新) │
│                                                         │
│  Handlers:                                              │
│  - handleScheduleSuccess()    (排课成功回调)             │
│  - handleOperationSuccess()   (操作成功回调)             │
│                                                         │
└─────────────────────────────────────────────────────────┘
         │                    │                    │
         ▼                    ▼                    ▼
┌──────────────┐  ┌──────────────────┐  ┌──────────────────┐
│ Calendar     │  │ BatchSchedule    │  │ Operations       │
│              │  │                  │  │                  │
│ State:       │  │ State:           │  │ State:           │
│ - viewType   │  │ - timeSlots      │  │ - schedules      │
│ - mode       │  │ - previewData    │  │ - selectedItem   │
│ - date       │  │ - showPreview    │  │ - modalVisible   │
│ - schedules  │  │ - loading        │  │ - operationType  │
│ - selected   │  │                  │  │ - conflicts      │
│              │  │                  │  │                  │
└──────────────┘  └──────────────────┘  └──────────────────┘
```

## 样式主题

```
┌─────────────────────────────────────────────────────────┐
│                      深色科技风格                         │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  主色调:                                                 │
│  - 青色: #00d4ff → #0099ff (渐变)                       │
│  - 背景: #111827                                        │
│                                                         │
│  辅助色:                                                 │
│  - 成功/绿色: #00ff88                                    │
│  - 警告/橙色: #ffaa00                                    │
│  - 错误/红色: #ff4d6a                                    │
│                                                         │
│  效果:                                                   │
│  - 发光边框: rgba(0, 212, 255, 0.3)                     │
│  - 半透明背景: rgba(0, 212, 255, 0.05)                  │
│  - 阴影: 0 4px 15px rgba(0, 212, 255, 0.3)             │
│                                                         │
└─────────────────────────────────────────────────────────┘
```
