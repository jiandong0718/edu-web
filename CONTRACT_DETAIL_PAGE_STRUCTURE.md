# 合同详情页面结构图

## 页面整体布局

```
┌─────────────────────────────────────────────────────────────────┐
│  面包屑导航                                                       │
│  首页 > 财务管理 > 合同管理 > 合同详情                            │
├─────────────────────────────────────────────────────────────────┤
│  页面标题: 合同详情 - HT202401001                                │
│                                          [打印] [作废] [返回]     │
├─────────────────────────────────────────────────────────────────┤
│  ┌───────────────────────────────────────────────────────────┐  │
│  │  Tab页签                                                   │  │
│  │  [合同基本信息] [合同明细] [支付记录] [课时账户]           │  │
│  ├───────────────────────────────────────────────────────────┤  │
│  │                                                             │  │
│  │  Tab内容区域                                                │  │
│  │                                                             │  │
│  └───────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
```

## Tab1: 合同基本信息

```
┌─────────────────────────────────────────────────────────────────┐
│  金额统计卡片                                                     │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐          │
│  │ 合同金额  │ │ 已付金额  │ │ 欠费金额  │ │ 优惠金额  │          │
│  │ ¥3,999   │ │ ¥3,999   │ │ ¥0       │ │ ¥0       │          │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘          │
├─────────────────────────────────────────────────────────────────┤
│  基本信息表格                                                     │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 合同编号    │ HT202401001        │ 合同状态 │ [已签署]  │   │
│  ├─────────────────────────────────────────────────────────┤   │
│  │ 签署日期    │ 2024-01-15         │ 有效期   │ 2024-01-15│   │
│  │             │                    │          │至2025-01-15│   │
│  ├─────────────────────────────────────────────────────────┤   │
│  │ 学员姓名    │ 张小明             │ 学员手机 │ 138xxx    │   │
│  ├─────────────────────────────────────────────────────────┤   │
│  │ 所属校区    │ 北京朝阳校区        │ 销售人员 │ 李老师    │   │
│  ├─────────────────────────────────────────────────────────┤   │
│  │ 备注        │ 无                                         │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

## Tab2: 合同明细

```
┌─────────────────────────────────────────────────────────────────┐
│  课程明细表格                                                     │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 课程名称 │ 课时数 │ 单价  │ 小计  │ 折扣  │ 实付金额  │   │
│  ├─────────────────────────────────────────────────────────┤   │
│  │ 少儿编程 │   48   │ ¥100 │ ¥4800│ -¥800│  ¥3,999   │   │
│  │ 入门班   │        │      │      │      │            │   │
│  ├─────────────────────────────────────────────────────────┤   │
│  │ 合计     │   48   │      │      │      │  ¥3,999   │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

## Tab3: 支付记录

```
┌─────────────────────────────────────────────────────────────────┐
│  支付记录表格                                                     │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 支付时间    │ 支付方式 │ 支付金额 │ 收据编号 │ 操作人 │操作│   │
│  ├─────────────────────────────────────────────────────────┤   │
│  │ 2024-01-15  │ [微信]  │ ¥3,999  │ SK001   │ 张老师 │[查看]│   │
│  │ 10:30:00    │         │         │         │        │[打印]│   │
│  ├─────────────────────────────────────────────────────────┤   │
│  │ 已付总额    │         │ ¥3,999  │         │        │      │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

## Tab4: 课时账户

```
┌─────────────────────────────────────────────────────────────────┐
│  课时账户表格                                                     │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 课程名称 │总课时│已用│剩余│赠送│ 状态  │    操作        │   │
│  ├─────────────────────────────────────────────────────────┤   │
│  │ 少儿编程 │  48  │ 12 │ 36 │ 0  │[正常] │ [消课记录]    │   │
│  │ 入门班   │      │    │    │    │       │               │   │
│  ├─────────────────────────────────────────────────────────┤   │
│  │ 合计     │      │    │ 36 │    │       │               │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

## 交互流程

### 1. 页面加载流程
```
用户访问 /finance/contract/123
    ↓
路由匹配，加载 Detail.tsx
    ↓
useEffect 触发，调用 loadContractDetail()
    ↓
并行请求4个API接口
    ├─ getContractDetail(123)      → 合同基本信息
    ├─ getContractItems(123)       → 合同明细
    ├─ getPaymentRecords(123)      → 支付记录
    └─ getHourAccounts(123)        → 课时账户
    ↓
数据加载完成，渲染页面
    ↓
默认显示 Tab1（合同基本信息）
```

### 2. 打印合同流程
```
用户点击 [打印] 按钮
    ↓
打开 ContractPrintModal 弹窗
    ↓
用户选择打印模板、打印类型、份数
    ↓
点击 [确认打印]
    ↓
调用 printContract() API
    ↓
POST /finance/contract/print
    ↓
打印成功，显示提示
    ↓
关闭弹窗
```

### 3. 作废合同流程
```
用户点击 [作废] 按钮
    ↓
显示确认弹窗
    ↓
用户点击 [确定]
    ↓
调用 cancelContract(id) API
    ↓
PUT /finance/contract/{id}/cancel
    ↓
作废成功
    ↓
刷新页面数据
    ↓
合同状态变为 [已作废]
    ↓
[作废] 按钮隐藏
```

### 4. Tab切换流程
```
用户点击 Tab2（合同明细）
    ↓
setActiveTab('2')
    ↓
Tabs组件切换到 Tab2
    ↓
显示合同明细表格
    ↓
渲染课程列表和汇总行
```

### 5. 查看收据流程（预留）
```
用户点击 [查看收据] 按钮
    ↓
调用 getReceiptDetail(paymentId)
    ↓
GET /finance/payment/receipt/{paymentId}
    ↓
打开收据详情弹窗
    ↓
显示收据信息
```

### 6. 查看消课记录流程（预留）
```
用户点击 [消课记录] 按钮
    ↓
调用消课记录API
    ↓
GET /finance/class-hour/consumption/list?accountId={id}
    ↓
打开消课记录弹窗
    ↓
显示消课明细列表
```

## 数据流向

```
┌─────────────┐
│   后端API    │
└──────┬──────┘
       │
       │ HTTP Request
       ↓
┌─────────────┐
│  API Layer  │  (src/api/contract.ts)
│             │  - getContractDetail()
│             │  - getContractItems()
│             │  - getPaymentRecords()
│             │  - getHourAccounts()
│             │  - cancelContract()
└──────┬──────┘
       │
       │ Promise
       ↓
┌─────────────┐
│ React State │  (Detail.tsx)
│             │  - contract
│             │  - items
│             │  - payments
│             │  - hourAccounts
└──────┬──────┘
       │
       │ Props
       ↓
┌─────────────┐
│  UI Layer   │  (Tabs, Table, Descriptions)
│             │  - Tab1: 基本信息
│             │  - Tab2: 合同明细
│             │  - Tab3: 支付记录
│             │  - Tab4: 课时账户
└─────────────┘
```

## 样式层级

```
.contract-detail (根容器)
    │
    ├─ Breadcrumb (面包屑)
    │
    ├─ PageHeader (标题 + 按钮)
    │
    └─ Card (主卡片)
        │
        └─ Tabs (页签容器)
            │
            ├─ Tab1
            │   ├─ Row (统计卡片行)
            │   │   └─ Col × 4 (4个统计卡片)
            │   │       └─ Card.stat-card
            │   │           └─ Statistic
            │   │
            │   └─ Descriptions (基本信息表格)
            │
            ├─ Tab2
            │   └─ Table (合同明细表格)
            │       ├─ Table.Header
            │       ├─ Table.Body
            │       └─ Table.Summary (汇总行)
            │
            ├─ Tab3
            │   └─ Table (支付记录表格)
            │       ├─ Table.Header
            │       ├─ Table.Body
            │       └─ Table.Summary (汇总行)
            │
            └─ Tab4
                └─ Table (课时账户表格)
                    ├─ Table.Header
                    ├─ Table.Body
                    └─ Table.Summary (汇总行)
```

## 颜色使用规范

| 用途 | 颜色值 | 示例 |
|------|--------|------|
| 主色调 | #00d4ff | Tab激活态、链接、高亮文字 |
| 成功/正常 | #00ff88 | 已付金额、剩余课时、正常状态 |
| 警告/提醒 | #ffaa00 | 已用课时、到期提醒 |
| 危险/错误 | #ff4d6a | 欠费金额、已作废、错误状态 |
| 中性/禁用 | #999 | 草稿状态、禁用文字 |
| 背景深色 | #0a0e1a | 页面背景 |
| 卡片背景 | #1a1f2e | 卡片渐变起始色 |
| 边框 | rgba(0,212,255,0.2) | 卡片边框、表格边框 |

## 响应式断点

| 屏幕宽度 | 布局调整 |
|---------|---------|
| < 768px | 统计卡片改为2列 |
| < 576px | 统计卡片改为1列 |
| 表格 | 始终支持横向滚动 |

## 性能优化点

1. **并行请求**: 使用 Promise.all 同时请求4个接口
2. **懒加载**: 路由使用 lazy 动态导入
3. **虚拟滚动**: 大数据表格可使用虚拟滚动（待优化）
4. **缓存**: 可添加数据缓存机制（待优化）
5. **防抖**: 搜索、筛选操作可添加防抖（待优化）

## 可访问性

1. **键盘导航**: 支持 Tab 键切换焦点
2. **语义化标签**: 使用正确的 HTML 语义
3. **ARIA 属性**: Ant Design 组件自带 ARIA 支持
4. **颜色对比度**: 文字与背景对比度符合 WCAG 标准
5. **焦点指示**: 按钮、链接有明显的焦点样式
